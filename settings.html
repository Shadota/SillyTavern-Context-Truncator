<div id="context_truncator_settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Context Truncator with Summarization</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- Enable/Disable -->
            <div class="flex-container flexFlowColumn">
                <label class="checkbox_label" for="ct_enabled">
                    <input id="ct_enabled" type="checkbox" />
                    <span>Enable Context Truncator</span>
                </label>
                <small>Enable or disable the extension</small>
            </div>

            <hr>

            <!-- Truncation Settings -->
            <h4>Truncation Settings</h4>
            
            <div class="flex-container flexFlowColumn">
                <label for="ct_target_size">
                    <span>Target Context Size (tokens)</span>
                </label>
                <input id="ct_target_size" class="text_pole" type="number" min="1000" max="200000" step="1000" />
                <small>Target maximum context size in tokens. When exceeded, older messages will be truncated and summarized.</small>
            </div>

            <div class="flex-container flexFlowColumn">
                <label for="ct_batch_size">
                    <span>Batch Size (messages)</span>
                </label>
                <input id="ct_batch_size" class="text_pole" type="number" min="1" max="100" step="1" />
                <small>Number of messages to truncate at once. Larger batches are more cache-efficient.</small>
            </div>

            <div class="flex-container flexFlowColumn">
                <label for="ct_min_keep">
                    <span>Minimum Messages to Keep</span>
                </label>
                <input id="ct_min_keep" class="text_pole" type="number" min="1" max="100" step="1" />
                <small>Minimum number of recent messages to always keep in context (safety limit).</small>
            </div>

            <hr>

            <!-- Summarization Settings -->
            <h4>Summarization Settings</h4>
            
            <div class="flex-container flexFlowColumn">
                <label class="checkbox_label" for="ct_auto_summarize">
                    <input id="ct_auto_summarize" type="checkbox" />
                    <span>Auto-Summarize Messages</span>
                </label>
                <small>Automatically summarize messages when they are truncated from context</small>
            </div>

            <div class="flex-container flexFlowColumn">
                <button id="ct_summarize_all" class="menu_button">
                    <i class="fa-solid fa-compress"></i>
                    <span>Summarize All Messages</span>
                </button>
                <small>Manually summarize all messages in the current chat that don't have summaries yet</small>
            </div>

            <hr>

            <!-- Status and Controls -->
            <h4>Status and Controls</h4>
            
            <div class="flex-container flexFlowColumn">
                <div id="ct_status_display" style="padding: 10px; border-radius: 5px; margin-bottom: 10px; display: none;">
                    <div style="font-weight: bold; margin-bottom: 5px;">Last Generation:</div>
                    <div id="ct_status_text"></div>
                </div>
            </div>
            
            <div class="flex-container flexFlowColumn">
                <button id="ct_reset" class="menu_button">
                    <i class="fa-solid fa-rotate-left"></i>
                    <span>Reset Truncation</span>
                </button>
                <small>Reset truncation index and recalculate on next generation</small>
            </div>

            <hr>

            <!-- Debug Mode -->
            <div class="flex-container flexFlowColumn">
                <label class="checkbox_label" for="ct_debug">
                    <input id="ct_debug" type="checkbox" />
                    <span>Debug Mode</span>
                </label>
                <small>Enable detailed console logging for troubleshooting</small>
            </div>

            <hr>

            <!-- Info -->
            <div class="flex-container flexFlowColumn">
                <small>
                    <b>How it works:</b><br>
                    1. Extension monitors prompt size after each generation<br>
                    2. When size exceeds target, older messages are marked for truncation<br>
                    3. Truncated messages are automatically summarized (if enabled)<br>
                    4. Summaries are injected into the prompt as a compact list<br>
                    5. Truncation happens in batches for cache efficiency<br>
                    <br>
                    <b>Note:</b> Summaries are generated using your current AI model. The first truncation may take a moment while summaries are generated.
                </small>
            </div>
        </div>
    </div>
</div>
